<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Uber exercise - Essential skills for reproducible research computing</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Uber exercise";
    var mkdocs_page_input_path = "nix/uber.md";
    var mkdocs_page_url = "/nix/uber/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Essential skills for reproducible research computing</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
    
<li>
          
            <li>
    <ul class="subnav">
    <li><span>UNIX Command Line</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../setup/">Setup</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../navigation/">Navigation</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../file_handling/">File Creation and Editing</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../redirection/">Redirection</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../pipes/">Piping</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../man_and_less/">man and less</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 current">
        <a class="current" href="./">Uber exercise</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#uber-example">uber example</a></li>
                
            
            </ul>
        
    </li>
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>(I)Python</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../python/python/">Python</a>
        
    </li>
    

        
            
    

        
            
    

        
            
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Software Licensing</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../openlicenses/openlicensing/">Open Licensing</a>
        
    </li>
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>git</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../git/git/">git</a>
        
    </li>
    

        
            
    <ul class="subnav">
    <li><span>GitHub</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../git/github1/">push and pull</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../git/merge/">merging</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../git/conflicts/">conflicts</a>
        
    </li>
    

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Jupyter</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../jupyter/the_notebook/">Navigating the notebook</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../jupyter/1/">The Python Scientific Stack</a>
        
    </li>
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Laplace</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../laplace/1/">Elliptic PDEs</a>
        
    </li>
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Numba</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../numba/1/">Profiling</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../numba/2/">Intro to JIT</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../numba/3/">Numba Internals</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../numba/4/">CFD Intro</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../numba/5/">Cavity Flow</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../numba/6/">vectorize</a>
        
    </li>
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>References</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../references/">References</a>
        
    </li>
    

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Essential skills for reproducible research computing</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>UNIX Command Line &raquo;</li>
        
      
    
    <li>Uber exercise</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="uber-example">uber example</h1>
<p>You downloaded a zip file at the beginning of the workshop. Time to use it!</p>
<p>First, navigate to the <code>Downloads</code> folder.</p>
<p>We need to unzip the zip file -- any guesses about what command unzips files?</p>
<pre><code class="text">unzip uber-trip-data-master.zip
</code></pre>

<p>By default, <code>unzip</code> will create a folder with the same name as the <code>zip</code> file
(without the <code>.zip</code> part). If you want to unzip the file to a different
location, you can use the <code>-d</code> flag.</p>
<p>For example:</p>
<pre><code class="text">unzip uber-trip-data-master.zip -d ~/uber-trip-data
</code></pre>

<p>Now you should have a folder called <code>uber-trip-data</code> or something similar,
depending on where and how you unzipped it. <code>cd</code> to that directory and take a
look.</p>
<pre><code class="text">$ cd uber-trip-data/
</code></pre>

<pre><code class="text">$ ls
</code></pre>

<pre><code class="text">taxi-zone-lookup.csv     uber-raw-data-janjune-15.csv.zip  uber-raw-data-may14.csv
uber-raw-data-apr14.csv  uber-raw-data-jul14.csv           uber-raw-data-sep14.csv
uber-raw-data-aug14.csv  uber-raw-data-jun14.csv
</code></pre>

<p>We have several raw data files (so named). <code>csv</code> files divided by month and also
a zip file. We'll leave the zip file alone for the moment. What questions can we
answer about this dataset from the command line?</p>
<p>First, it would help to know what these files contain. We can use <code>head</code> to
display the first ten lines of one of the raw files.</p>
<pre><code class="text">$ head uber-raw-data-apr14.csv
</code></pre>

<pre><code class="text">&quot;Date/Time&quot;,&quot;Lat&quot;,&quot;Lon&quot;,&quot;Base&quot;
&quot;4/1/2014 0:11:00&quot;,40.769,-73.9549,&quot;B02512&quot;
&quot;4/1/2014 0:17:00&quot;,40.7267,-74.0345,&quot;B02512&quot;
&quot;4/1/2014 0:21:00&quot;,40.7316,-73.9873,&quot;B02512&quot;
&quot;4/1/2014 0:28:00&quot;,40.7588,-73.9776,&quot;B02512&quot;
&quot;4/1/2014 0:33:00&quot;,40.7594,-73.9722,&quot;B02512&quot;
&quot;4/1/2014 0:33:00&quot;,40.7383,-74.0403,&quot;B02512&quot;
&quot;4/1/2014 0:39:00&quot;,40.7223,-73.9887,&quot;B02512&quot;
&quot;4/1/2014 0:45:00&quot;,40.762,-73.979,&quot;B02512&quot;
&quot;4/1/2014 0:55:00&quot;,40.7524,-73.996,&quot;B02512&quot;
</code></pre>

<p>They weren't kidding when they said "raw" data. What do we have here? Looks like
a date and time (these are pickup times), the lat-long of the pickup location
and some "Base" id that we don't care about right now.</p>
<p>What can we take away from this?</p>
<p>For one, that the number of lines in this file is how many pickups Uber made
during the month of April, 2014. That sounds like interesting information. We
can use <code>wc</code> or <code>wordcount</code> to count the number of <em>lines</em> in a file by using
the <code>-l</code> flag.</p>
<pre><code class="text">$ wc -l uber-raw-data-apr14.csv
</code></pre>

<pre><code class="text">564517 uber-raw-data-apr14.csv
</code></pre>

<p>We know now that Uber provided more than half a million rides in New York City
in April of 2014. Let's take a look at how that figure changes month-to-month!</p>
<p>We can run the same <code>wc</code> command but now use the <code>*</code> wildcard to get the
linecount of every file in the directory.</p>
<pre><code class="text">$ wc -l *
</code></pre>

<pre><code class="text">        0 taxi-zone-lookup.csv
   564517 uber-raw-data-apr14.csv
   829276 uber-raw-data-aug14.csv
   284595 uber-raw-data-janjune-15.csv.zip
   796122 uber-raw-data-jul14.csv
   663845 uber-raw-data-jun14.csv
   652436 uber-raw-data-may14.csv
  1028137 uber-raw-data-sep14.csv
  4818928 total
</code></pre>

<p>Cool, but the linecount of a zip file doesn't really make any sense. To be a
little more specific, restrict <code>wc</code> to only look at <code>csv</code> files.</p>
<pre><code class="text">$ wc -l *.csv
</code></pre>

<pre><code class="text">        0 taxi-zone-lookup.csv
   564517 uber-raw-data-apr14.csv
   829276 uber-raw-data-aug14.csv
   796122 uber-raw-data-jul14.csv
   663845 uber-raw-data-jun14.csv
   652436 uber-raw-data-may14.csv
  1028137 uber-raw-data-sep14.csv
  4534333 total
</code></pre>

<p>Better. <code>wc</code> outputs files in the order it gets them, which in this case is the
order they exist in the directory. And that's alphabetical order. The names of
months aren't hugely useful when sorting alphabetically.</p>
<p>Let's use the <code>sort</code> command to sort the results from <code>wc</code>. We can pipe the
output of <code>wc</code> to <code>sort</code> using the <code>|</code> character. Remember, the pipe takes the
output from the previous command and hands it off to the following command.</p>
<pre><code class="text">$ wc -l *.csv | sort
</code></pre>

<pre><code class="text">        0 taxi-zone-lookup.csv
  1028137 uber-raw-data-sep14.csv
  4534333 total
   564517 uber-raw-data-apr14.csv
   652436 uber-raw-data-may14.csv
   663845 uber-raw-data-jun14.csv
   796122 uber-raw-data-jul14.csv
   829276 uber-raw-data-aug14.csv
</code></pre>

<p>Hmmm.  That looks a little funny.  Can you see what <code>sort</code> did?</p>
<p>Yeah, it sorted things alphanumerically, which isn't helpful since it only looks
at leading digits. We want to use the number of lines in each file as the
sorting criteria.</p>
<p>To do this, we can use the <code>-n</code> flag with <code>sort</code> to specify a "numerical" sort.</p>
<p>This may start to look a little confusing, but remember, we're just building up
a command using smaller commands. We use the <code>-l</code> flag with <code>wc</code> to count the
number of lines, then pipe that output to <code>sort</code> where we use the <code>-n</code> flag to
require numerical sorting.</p>
<pre><code class="text">$ wc -l *.csv | sort -n
</code></pre>

<pre><code class="text">        0 taxi-zone-lookup.csv
   564517 uber-raw-data-apr14.csv
   652436 uber-raw-data-may14.csv
   663845 uber-raw-data-jun14.csv
   796122 uber-raw-data-jul14.csv
   829276 uber-raw-data-aug14.csv
  1028137 uber-raw-data-sep14.csv
  4534333 total
</code></pre>

<p>Ok! Now we have the raw data files sorted by number of lines, which we know is
equivalent to number of rides. And look, now the months are in the correct
order. That wasn't necessarily expected, but looking at this output we can see
that Uber is expanding at a pretty fast pace in 2014; they nearly doubled their
usage numbers in 5 months!</p>
<p>This data set is missing the last quarter of 2014, but we have the first half of
2015 available, so we can check if the trend continues (is there a ceiling for
Uber requests in NYC?)</p>
<p>First, unzip the file containing the 2015 data.</p>
<pre><code class="text">$ unzip uber-raw-data-janjune-15.csv.zip
</code></pre>

<pre><code class="text">Archive:  uber-raw-data-janjune-15.csv.zip
  inflating: uber-raw-data-janjune-15.csv
   creating: __MACOSX/
  inflating: __MACOSX/._uber-raw-data-janjune-15.csv
</code></pre>

<p>Now we know that whoever created this zip file uses a Mac. But that's not really
important. Let's take another look at the line counts.</p>
<pre><code class="text">$ wc -l *.csv | sort -n
</code></pre>

<pre><code class="text">        0 taxi-zone-lookup.csv
   564517 uber-raw-data-apr14.csv
   652436 uber-raw-data-may14.csv
   663845 uber-raw-data-jun14.csv
   796122 uber-raw-data-jul14.csv
   829276 uber-raw-data-aug14.csv
  1028137 uber-raw-data-sep14.csv
 14270480 uber-raw-data-janjune-15.csv
 18804813 total
</code></pre>

<p>Wow! 14+ million rides! Impressive! But this data layout is different from the
2014 data. The six months are all in the same file. Not cool. So what now?</p>
<p>First, let's see what the data looks like in the combined file.</p>
<pre><code class="text">$ head uber-raw-data-janjune-15.csv
</code></pre>

<pre><code class="text">Dispatching_base_num,Pickup_date,Affiliated_base_num,locationID
B02617,2015-05-17 09:47:00,B02617,141
B02617,2015-05-17 09:47:00,B02617,65
B02617,2015-05-17 09:47:00,B02617,100
B02617,2015-05-17 09:47:00,B02774,80
B02617,2015-05-17 09:47:00,B02617,90
B02617,2015-05-17 09:47:00,B02617,228
B02617,2015-05-17 09:47:00,B02617,7
B02617,2015-05-17 09:47:00,B02764,74
B02617,2015-05-17 09:47:00,B02617,249
</code></pre>

<p>Very uncool. First, the data is in a different format than the previous files we
looked at. Worse, the first pickup listed is in May? Either the file is
mislabeled (bad) or it isn't even sorted (bad).</p>
<p>Let's look at a few more lines to see if we can figure out which bad scenario we
have.</p>
<p>We can use <code>tail</code> to peek at the <em>last</em> 10 lines in the file. How do those look?</p>
<pre><code class="text">$ tail uber-raw-data-janjune-15.csv
</code></pre>

<pre><code class="text">B02765,2015-05-08 15:42:00,B02764,79
B02765,2015-05-08 15:42:00,B02765,37
B02765,2015-05-08 15:42:00,B02765,161
B02765,2015-05-08 15:42:00,B02765,7
B02765,2015-05-08 15:43:00,B02711,25
B02765,2015-05-08 15:43:00,B02765,186
B02765,2015-05-08 15:43:00,B02765,263
B02765,2015-05-08 15:43:00,B02765,90
B02765,2015-05-08 15:44:00,B01899,45
B02765,2015-05-08 15:44:00,B02682,144
</code></pre>

<p>Not looking good.  Is this all just in May?  Let's look through a larger number of lines using <code>head</code> and see if we can find a ride that wasn't in May.  Use the <code>-n</code> flag with <code>head</code> to specify the number of lines to show (the default is 10).</p>
<pre><code class="text">$ head -n 500 uber-raw-data-janjune-15.csv
</code></pre>

<pre><code class="text">[snip]
B02598,2015-01-18 11:06:58,B02598,7
B02598,2015-01-18 18:55:46,B02598,141
B02598,2015-01-18 14:54:28,B02598,249
B02598,2015-01-18 20:48:57,B02598,90
B02598,2015-01-18 09:28:20,B02682,234
B02598,2015-01-18 19:31:14,B02764,13
B02598,2015-01-18 14:13:38,B02598,163
B02598,2015-01-18 22:53:57,B02598,90
B02598,2015-01-18 19:13:00,B02617,246
B02598,2015-01-18 14:53:36,B02598,161
B02598,2015-01-18 02:37:00,B02598,114
B02598,2015-01-18 18:47:01,B02598,113
B02598,2015-01-18 16:06:11,B02598,233
B02598,2015-01-18 15:36:12,B02598,162
B02598,2015-01-18 02:10:39,B02598,50
B02598,2015-01-18 12:18:57,B02764,142
B02598,2015-01-18 14:03:01,B02598,37
</code></pre>

<p>Ok. 500 lines in, we can see some January pickups. It looks like we have bad
option #2. The data is labeled correctly but isn't sorted. Time to sort it!</p>
<p>Sorting can be expensive, so rather than trying to sort the whole file at once,
let's copy a portion of the big file into a separate file.</p>
<p>Use the same <code>head</code> command we just used, but now, instead of writing it to the
screen, we can <em>redirect</em> that output to another file using <code>&gt;</code>. We'll just call
that file <code>test.csv</code>.</p>
<pre><code class="text">$ head -n 500 uber-raw-data-janjune-15.csv &gt; test.csv
</code></pre>

<p>Now it's time to figure out how to sort this data. We can use <code>sort</code> the way we
did with <code>wc</code> because the information we want to use as the sort key (the date
and time) are embedded in the middle of every line.</p>
<p>Here's one line from <code>test.csv</code>:</p>
<p><code>B02598,2015-01-18 14:03:01,B02598,37</code></p>
<p>We already looked at using <code>sort</code> with <code>fields</code> and the <code>-k</code> flag. Let's try it
here:</p>
<p>We're going to <code>cat</code> all of <code>test.csv</code>, pipe that into <code>sort</code> and then use the
<code>-k2</code> flag, which will sort the lines of <code>test.csv</code> based on the first character
of the <em>second</em> field/column.</p>
<pre><code class="text">$ cat test.csv | sort -k2 | less
</code></pre>

<p>That... didn't work. The default field delimiter in <code>sort</code> is whitespace, so the
previous command sorted everything based on pickup time, but ignored pickup
date.</p>
<p>How can we change the delimiter character that <code>sort</code> uses? Let's check the
<code>man</code> page.</p>
<pre><code class="text">$ man sort
</code></pre>

<pre><code class="text">$ cat test.csv | sort -t &quot;,&quot; -k2 | less
</code></pre>

<pre><code class="text">$ cat test.csv | sort -t &quot;,&quot; -k2 &gt; test_sort.csv
</code></pre>

<pre><code class="text">$ head test_sort.csv
</code></pre>

<pre><code class="text">B02598,2015-01-18 00:02:54,,144

B02598,2015-01-18 00:05:05,B02598,50

B02598,2015-01-18 00:06:19,B02598,107

B02598,2015-01-18 00:08:14,B02598,142

B02598,2015-01-18 00:16:58,B02598,107

B02598,2015-01-18 00:30:59,B02598,50

B02598,2015-01-18 00:36:16,B02598,211

B02598,2015-01-18 00:37:16,B02774,141

B02598,2015-01-18 00:45:16,,48

B02598,2015-01-18 00:47:08,B02617,68

</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../python/python/" class="btn btn-neutral float-right" title="Python">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../man_and_less/" class="btn btn-neutral" title="man and less"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />Content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. <br> Code is licensed under BSD 3-Clause.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a> and deployed using <a href="https://drdoctr.github.io/doctr">doctr</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../man_and_less/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../python/python/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</body>
</html>
