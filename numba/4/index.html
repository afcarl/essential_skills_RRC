<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>CFD Intro - Essential skills for reproducible research computing</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "CFD Intro";
    var mkdocs_page_input_path = "numba/4.md";
    var mkdocs_page_url = "/numba/4/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Essential skills for reproducible research computing</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
    
<li>
          
            <li>
    <ul class="subnav">
    <li><span>UNIX Command Line</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../nix/navigation/">Navigation</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../nix/file_handling/">File Creation and Editing</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../nix/redirection/">Redirection</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../nix/pipes/">Piping</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../nix/man_and_less/">man and less</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../nix/uber/">Uber exercise</a>
        
    </li>
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>(I)Python</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../python/python/">Python</a>
        
    </li>
    

        
            
    

        
            
    

        
            
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>git</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../git/git/">git</a>
        
    </li>
    

        
            
    <ul class="subnav">
    <li><span>GitHub</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../git/github1/">push and pull</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../git/merge/">merging</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../git/conflicts/">conflicts</a>
        
    </li>
    

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Jupyter</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../jupyter/the_notebook/">Navigating the notebook</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../jupyter/1/">The Python Scientific Stack</a>
        
    </li>
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Laplace</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../../laplace/1/">Elliptic PDEs</a>
        
    </li>
    

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Numba</span></li>

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../1/">Profiling</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../2/">Intro to JIT</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../3/">Numba Internals</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 current">
        <a class="current" href="./">CFD Intro</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#application-pressure-poisson-equation">Application - Pressure Poisson Equation</a></li>
                
            
                <li class="toctree-l3"><a href="#solution-procedure">Solution procedure</a></li>
                
                    <li><a class="toctree-l4" href="#initial-velocity-field">Initial velocity field</a></li>
                
                    <li><a class="toctree-l4" href="#calculate-pressure">Calculate pressure</a></li>
                
                    <li><a class="toctree-l4" href="#update-the-velocity">Update the velocity</a></li>
                
            
                <li class="toctree-l3"><a href="#what-we-left-out">What we left out</a></li>
                
            
            </ul>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../5/">Cavity Flow</a>
        
    </li>
    

        
            
    
    <li class="toctree-l1 ">
        <a class="" href="../6/">vectorize</a>
        
    </li>
    

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Essential skills for reproducible research computing</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Numba &raquo;</li>
        
      
    
    <li>CFD Intro</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="application-pressure-poisson-equation">Application - Pressure Poisson Equation</h2>
<p>The momentum equation for the velocity field $\vec{u}$ in a fluid is</p>
<p>
<script type="math/tex; mode=display">\begin{equation}
\frac{\partial \vec{u}}{\partial t}+(\vec{u}\cdot\nabla)\vec{u}=-\frac{1}{\rho}\nabla p + \nu \nabla^2\vec{u}
\end{equation}</script>
</p>
<p>where $p$ is the pressure, $\nu$ is the fluid viscosity and $\rho$ is the fluid density. With three velocity components, plus the pressure, we have four unknowns but only three equations. For compressible fluids, we have an equation of state to complete the system. In the incompressible case, we don't have an equation of state and we need an additional constraint from somewhere else. </p>
<p>This is what we do: take the divergence of the momentum equation, apply the incompressibility constraint to cancel some terms, and get an equation for the pressure. It's a pretty cool trick.</p>
<p>Conservation of mass for an incompressible fluid requires that the divergence of $\vec{u}$ must be zero:</p>
<p>
<script type="math/tex; mode=display">\nabla \cdot \vec{u} = 0</script>
</p>
<p>Writing out the momentum equation in $x$ and $y$ components (for two-dimensional flow), we get</p>
<p>
<script type="math/tex; mode=display">\frac{\partial u}{\partial t}+u\frac{\partial u}{\partial x}+v\frac{\partial u}{\partial y} = -\frac{1}{\rho}\frac{\partial p}{\partial x}+\nu \left(\frac{\partial^2 u}{\partial x^2}+\frac{\partial^2 u}{\partial y^2} \right) </script>
</p>
<p>
<script type="math/tex; mode=display">\frac{\partial v}{\partial t}+u\frac{\partial v}{\partial x}+v\frac{\partial v}{\partial y} = -\frac{1}{\rho}\frac{\partial p}{\partial y}+\nu\left(\frac{\partial^2 v}{\partial x^2}+\frac{\partial^2 v}{\partial y^2}\right) </script>
</p>
<p>We take the divergence of the momentum equation and then apply the incompressibility constraint.  After some wrangling and cancellations, this leaves us with the pressure Poisson equation:</p>
<p>
<script type="math/tex; mode=display">\frac{\partial^2 p}{\partial x^2}+\frac{\partial^2 p}{\partial y^2} = -\rho\left(\frac{\partial u}{\partial x}\frac{\partial u}{\partial x}+2\frac{\partial u}{\partial y}\frac{\partial v}{\partial x}+\frac{\partial v}{\partial y}\frac{\partial v}{\partial y} \right)</script>
</p>
<p>Which is an equation of the form</p>
<p>
<script type="math/tex; mode=display">\frac{\partial ^2 p}{\partial x^2} + \frac{\partial ^2 p}{\partial y^2} = b</script>
</p>
<p>Imagine we discretize a domain using a uniform mesh of points in each spatial direction, as in the figure below:</p>
<p><img src='../figures/2dgrid.svg' width=350></p>
<p>Then the left-hand side of the Poisson equation, i.e., the Laplacian differential operator applied to $p$, is discretized using 2nd-order central differences as follows</p>
<p>
<script type="math/tex; mode=display">\frac{p^n_{i+1, j} - 2p^n_{i,j} + p^n_{i - 1, j}}{\Delta x ^2} + \frac{p^n_{i, j+1} - 2p^n_{i,j} + p^n_{i, j-1}}{\Delta y ^2}</script>
</p>
<p>where subscripts $i,j$ denote the spatial location on a Cartesian coordinate system and superscripts $n$ denote a point in time.</p>
<p>We apply an appropriate finite-difference discretization to the momentum equation (forward-time, backward-space for the 1st-order terms) and also assume a uniform mesh, so $\Delta x = \Delta y$.</p>
<p>Using this discretized form in the Poisson equation, we will leave only the $p_{i,j}$ terms in the left-hand side, and move the other terms to the right. Then we say that we can update all the values of $p_{i,j}$ using the values at the neighboring points for both $p$ and $u, v$. This update, repeated many times, happens to converge to the solution of Poisson's equation.</p>
<h2 id="solution-procedure">Solution procedure</h2>
<h3 id="initial-velocity-field">Initial velocity field</h3>
<p>We start with a velocity field in $u$ and $v$ at some timestep $n$. </p>
<h3 id="calculate-pressure">Calculate pressure</h3>
<p>Then, we iteratively solve the Poisson equation for pressure, as described above. Starting with an initial guess, the values $p_{i,j}$ are updated using the neighboring values of $p$, $u$ and $v$ at $(i+1,j)$ and $(i,j+1)$. The updates can be written as follows, where the $k$ superscript denotes an iteration in 'pseudo-time':</p>
<p>
<script type="math/tex; mode=display">\begin{align}
p_{i,j}^{k+1} &= \frac{1}{4}\left(p_{i+1,j}^{k}+p_{i-1,j}^{k}+p_{i,j+1}^{k}+p_{i,j-1}^{k}\right) \\
&-\frac{\rho \Delta x}{16} \left( \frac{2}{\Delta t} \left(u_{i+1,j} - u_{i-1,j} + v_{i,j+1} - v_{i,j-1}\right) \right . \\
&-\frac{2}{\Delta x}\left(u_{i,j+1} - u_{i,j-1} \right) \left(v_{i+1,j} - v_{i-1,j} \right) \\
&- \left . \frac{\left(u_{i+1,j} - u_{i-1,j} \right)^2}{\Delta x} 
- \frac{ \left(v_{i,j+1} - v_{i,j-1} \right)^2 }{\Delta x} \right) \\
\end{align}</script>
</p>
<p>In other words, we repeatedly apply the Poisson equation until the pressure reaches a quasi-steady state.</p>
<h3 id="update-the-velocity">Update the velocity</h3>
<p>Once the pressure field reaches its quasi-steady state via the Poisson equation, we use that field for the current time step, $p^n$, to solve for the velocity components $u$ and $v$ at the next timestep, $n+1$.</p>
<p>The momentum equation in the $u$ direction:</p>
<p>
<script type="math/tex; mode=display">\begin{align}
u_{i,j}^{n+1} = u_{i,j}^{n} &- \frac{\Delta t}{\Delta x} \left( u_{i,j}^{n}(u_{i,j}^{n}-u_{i-1,j}^{n})
+ v_{i,j}^{n} (u_{i,j}^{n}-u_{i,j-1}^{n}) + \frac{1}{2 \rho}(p_{i+1,j}^{n}-p_{i-1,j}^{n}) \right) \\
&+\frac{\nu \Delta t}{\Delta x^2}\left(u_{i+1,j}^{n} + u_{i-1,j}^{n} + u_{i,j+1}^{n} + u_{i,j-1}^{n} -4u_{i,j}^{n}\right)
\end{align}</script>
</p>
<p>The momentum equation in the $v$ direction:</p>
<p>
<script type="math/tex; mode=display">\begin{align}
v_{i,j}^{n+1} = v_{i,j}^{n} &- \frac{\Delta t}{\Delta x} \left( u_{i,j}^{n}(v_{i,j}^{n}-v_{i-1,j}^{n})
+ v_{i,j}^{n} (v_{i,j}^{n}-v_{i,j-1}^{n}) + \frac{1}{2 \rho}(p_{i,j+1}^{n}-p_{i,j-1}^{n}) \right) \\
&+\frac{\nu \Delta t}{\Delta x^2}\left(v_{i+1,j}^{n} + v_{i-1,j}^{n} + v_{i,j+1}^{n} + v_{i,j-1}^{n} -4v_{i,j}^{n}\right)
\end{align}</script>
</p>
<p>Then, rinse and repeat.</p>
<h2 id="what-we-left-out">What we left out</h2>
<p>There are various subtleties that we left out here, to get quickly to the equations we need in the code. First, there are some variations on the form of the pressure Poisson equation, depending on what terms involving $\nabla\cdot\vec{u}$ one chooses to cancel (this has caused long arguments in the literature!). Second, we say nothing about the boundary conditions, which can cause some trouble (and more arguments!). And third, we show only the simplest iterative method for solving the Poisson equation, which also happens to be the slowest to converge. This is just meant to be a pedagogical example and discussion of these subtleties would be part of a full-fledged CFD course.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../5/" class="btn btn-neutral float-right" title="Cavity Flow">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../3/" class="btn btn-neutral" title="Numba Internals"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />Content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. <br> Code is licensed under BSD 3-Clause.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../3/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../5/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>
      <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</body>
</html>
